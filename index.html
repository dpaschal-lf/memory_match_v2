<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
<style>
.box{
  border: 1px solid red;
  display: flex;
  width: 20%;
  flex: .2;
  height: 20%;
 
}
#game_container{
  height: 100vw;
  width: 100vh;
  display: flex;
  flex-flow: row;
  background-color: lavender;
  justify-content: space-around;
}
.selected{
  border: 1px solid blue;
}
.matched{
  opacity: .2;
}
</style>
	<title></title>
	<script>
var box_list = [];
var colors = ['red','white','green'];
var box_object_template = function(color){

  var self = this;
  self.element = null;
  self.get_color = function(){
  	return this.element.css('background-color');
  };
  self.create_element = function(color){
    self.element = $('<div>',{
      class: 'box'
    });
    self.element.css('background-color',color);
    self.element.click(this.on_click)
    return self.element;
  };
  self.on_click = function(){
  	if($(this).hasClass('selected')){
      console.log('can\'t be clicked twice');
    	return;
    }
  console.log('I am this ',self);
    $(this).addClass('selected');
    if(first_clicked_box===null){
    	first_clicked_box = self;
      first_clicked_box.on_first_click();
    }
    else{
    	self.on_second_click();
      if(self.get_color() == first_clicked_box.get_color()){
      console.log('they match');
      	self.on_match();
        first_clicked_box.on_match();
      }
      else{
        console.log('they don\'t match');
      	self.on_mismatch();
        first_clicked_box.on_mismatch();
      }
      first_clicked_box = null;
    }
  };
  self.on_first_click = function(){
    console.log(self.element,'first click');
  };
  self.on_second_click = function(){
    console.log(self.element,'second click');
  };
  self.on_match = function(){
    $(self.element).addClass('matched');
  };
  self.on_mismatch = function(){
  	var self = this;
    self.revert_timer = setTimeout(self.unclick_self,3000);
  };
  self.unclick_self = function(){
  	self.element.removeClass('selected');
  }
  self.init = function(color){
    return this.create_element(color);
  };
  if(color!=='undefined')
  {
  	return this.init(color);
  }
};
var red_box_template = function(){
   var r_val = box_object_template.apply(this, arguments);
	//nothing new
	return r_val;
};

red_box_template.prototype = new box_object_template();
var white_box_template = function(){
  var self=this;
  var r_val = box_object_template.apply(this, arguments);
	//nothing new
  this.on_match = function(){
    alert('you lose!');
  };
  return r_val;
};
white_box_template.prototype = new box_object_template();
var green_box_template = function(){
  var r_val = box_object_template.apply(this, arguments);
	var self=this;
  self.on_first_click = function(){
    console.log(self.element,'super duper first click');
    
  };  
  return r_val;
};
green_box_template.prototype = new box_object_template();


var first_clicked_box = null;
function create_boxes(box_count){
  var game_controller = $("#game_container");
  for(var i=0; i<box_count; i++){
  	var color = colors[Math.floor(Math.random()*colors.length)];
    var box = new window[color+'_box_template'](color);
    game_controller.append(box);
    box_list.push(box);
    console.log(game_controller);

  }
}
$(document).ready(function(){
  create_boxes(10);
});

	</script>
</head>
<body>
<div id="game_container">
</div>
</body>
</html>